


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DataBroker Basics &mdash; NSLS-II Software Documentation 0.0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="NSLS-II Software Documentation 0.0.1 documentation" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> NSLS-II Software Documentation</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../architecture-overview.html">Event-Based Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collection-quick-start.html">Data Collection Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-quick-start.html">Data Analysis Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../analysis-quick-start.html#option-1-at-the-beamline">Option 1: At the Beamline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis-quick-start.html#option-2-remotely">Option 2: Remotely</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Recommended Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../resources.html#books-we-like">Books We Like</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources.html#scientific-python-packages-we-use">Scientific Python Packages We Use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources.html#good-scientific-software-habits">Good Scientific Software Habits</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../technologies.html">Core Technologies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../technologies.html#python">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../technologies.html#ipython">IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../technologies.html#jupyter-formerly-ipython-notebooks">Jupyter (formerly, IPython notebooks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../technologies.html#conda">Conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../technologies.html#mongodb">MongoDB</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">NSLS-II Software Documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>DataBroker Basics</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/broker/basics.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="databroker-basics">
<h1>DataBroker Basics<a class="headerlink" href="#databroker-basics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-the-data-broker">
<h2>What is the Data Broker?<a class="headerlink" href="#what-is-the-data-broker" title="Permalink to this headline">¶</a></h2>
<p>The Data Broker provides one interface for retrieving data from all sources.</p>
<p>You, the user, don&#8217;t have to know where the data is stored or in what format
it is stored. The Data Broker returns all the data in one simply-structured
bundle. All measurements are given as standard Python data types (integer,
float, or string) or numpy arrays.</p>
</div>
<div class="section" id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>This demonstrates the basic usage with minimal explanation. To understand what
is being done, read the next section.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">dataportal.broker</span> <span class="kn">import</span> <span class="n">DataBroker</span>

<span class="gp">In [2]: </span><span class="kn">from</span> <span class="nn">dataportal.muxer</span> <span class="kn">import</span> <span class="n">DataMuxer</span>

<span class="gp">In [3]: </span><span class="n">header</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># get most recent run</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AutoReconnect</span><span class="g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__init__</span><span class="nt">(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">365</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">366</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_connected</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">367</span>             <span class="k">except</span> <span class="n">AutoReconnect</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">_ensure_connected</span><span class="nt">(self, sync)</span>
<span class="g-Whitespace">    </span><span class="mi">929</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">930</span><span class="sd">         self.__ensure_member()</span>
<span class="g-Whitespace">    </span><span class="mi">931</span><span class="sd"> </span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__ensure_member</span><span class="nt">(self)</span>
<span class="g-Whitespace">    </span><span class="mi">802</span><span class="sd">                 try:</span>
<span class="ne">--&gt; </span><span class="mi">803</span><span class="sd">                     member, nodes = self.__find_node()</span>
<span class="g-Whitespace">    </span><span class="mi">804</span><span class="sd">                     return member</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__find_node</span><span class="nt">(self)</span>
<span class="g-Whitespace">    </span><span class="mi">893</span><span class="sd">             # Couldn&#39;t find a suitable host.</span>
<span class="ne">--&gt; </span><span class="mi">894</span><span class="sd">             raise AutoReconnect(&#39;, &#39;.join(errors))</span>
<span class="g-Whitespace">    </span><span class="mi">895</span><span class="sd"> </span>

<span class="ne">AutoReconnect</span>: [Errno 61] Connection refused

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="ne">ConnectionFailure</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">get_connection</span><span class="nt">(alias, reconnect)</span>
<span class="g-Whitespace">    </span><span class="mi">121</span><span class="sd">         try:</span>
<span class="ne">--&gt; </span><span class="mi">122</span><span class="sd">             _connections[alias] = connection_class(**conn_settings)</span>
<span class="g-Whitespace">    </span><span class="mi">123</span><span class="sd">         except Exception as e:</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__init__</span><span class="nt">(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">368</span><span class="sd">                 # ConnectionFailure makes more sense here than AutoReconnect</span>
<span class="ne">--&gt; </span><span class="mi">369</span><span class="sd">                 raise ConnectionFailure(str(e))</span>
<span class="g-Whitespace">    </span><span class="mi">370</span><span class="sd"> </span>

<span class="ne">ConnectionFailure</span>: [Errno 61] Connection refused

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="ne">ConnectionError</span><span class="g-Whitespace">                           </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-3-40ed62db5c60&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span><span class="sd"> header = DataBroker[-1]  # get most recent run</span>

<span class="nn">/Users/dallan/Documents/Repos/databroker/databroker/databroker.py</span> in <span class="ni">__getitem__</span><span class="nt">(self, key)</span>
<span class="g-Whitespace">     </span><span class="mi">62</span><span class="sd">             else:</span>
<span class="g-Whitespace">     </span><span class="mi">63</span><span class="sd">                 # Interpret key as the Nth last scan.</span>
<span class="ne">---&gt; </span><span class="mi">64</span><span class="sd">                 gen = find_last(-key)</span>
<span class="g-Whitespace">     </span><span class="mi">65</span><span class="sd">                 for i in range(-key):</span>
<span class="g-Whitespace">     </span><span class="mi">66</span><span class="sd">                     try:</span>

<span class="nn">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py</span> in <span class="ni">inner</span><span class="nt">(*args, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">117</span><span class="sd">         host = conf.connection_config[&#39;host&#39;]</span>
<span class="g-Whitespace">    </span><span class="mi">118</span><span class="sd">         port = int(conf.connection_config[&#39;port&#39;])</span>
<span class="ne">--&gt; </span><span class="mi">119</span><span class="sd">         db_connect(database=database, host=host, port=port)</span>
<span class="g-Whitespace">    </span><span class="mi">120</span><span class="sd">         return func(*args, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">121</span><span class="sd">     return inner</span>

<span class="nn">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py</span> in <span class="ni">db_connect</span><span class="nt">(database, host, port)</span>
<span class="g-Whitespace">     </span><span class="mi">96</span><span class="sd">        re-connect.</span>
<span class="g-Whitespace">     </span><span class="mi">97</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">98</span>     <span class="k">return</span> <span class="n">connect</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="n">ALIAS</span><span class="p">)</span>
<span class="g-Whitespace">     </span><span class="mi">99</span> 
<span class="g-Whitespace">    </span><span class="mi">100</span> 

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">connect</span><span class="nt">(db, alias, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">159</span>         <span class="n">register_connection</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">160</span> 
<span class="ne">--&gt; </span><span class="mi">161</span>     <span class="k">return</span> <span class="n">get_connection</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">162</span> 
<span class="g-Whitespace">    </span><span class="mi">163</span> 

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">get_connection</span><span class="nt">(alias, reconnect)</span>
<span class="g-Whitespace">    </span><span class="mi">122</span>             <span class="n">_connections</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection_class</span><span class="p">(</span><span class="o">**</span><span class="n">conn_settings</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">123</span>         <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">124</span>             <span class="k">raise</span> <span class="n">ConnectionError</span><span class="p">(</span><span class="s">&quot;Cannot connect to database </span><span class="si">%s</span><span class="s"> :</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
<span class="g-Whitespace">    </span><span class="mi">125</span>     <span class="k">return</span> <span class="n">_connections</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span>
<span class="g-Whitespace">    </span><span class="mi">126</span> 

<span class="ne">ConnectionError</span>: Cannot connect to database mds :
<span class="p">[</span><span class="n">Errno</span> <span class="mi">61</span><span class="p">]</span> <span class="n">Connection</span> <span class="n">refused</span>

<span class="gp">In [4]: </span><span class="n">events</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="o">.</span><span class="n">fetch_events</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-4-8927db3c3d9f&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 events = DataBroker.fetch_events(header)</span>

<span class="go">NameError: name &#39;header&#39; is not defined</span>

<span class="gp">In [5]: </span><span class="n">dm</span> <span class="o">=</span> <span class="n">DataMuxer</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-5-3cf5850c05d5&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 dm = DataMuxer.from_events(events)</span>

<span class="go">NameError: name &#39;events&#39; is not defined</span>

<span class="gp">In [6]: </span><span class="n">dm</span><span class="o">.</span><span class="n">sources</span>  <span class="c"># to review list of data sources</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-6-2cb4e71e1f7c&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 dm.sources  # to review list of data sources</span>

<span class="go">NameError: name &#39;dm&#39; is not defined</span>
</pre></div>
</div>
<p>You can plot individual data sources against time...</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [7]: </span><span class="n">dm</span><span class="p">[</span><span class="s">&#39;Tsam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>  <span class="c"># or the name of any data source</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-7-2a20c70a1259&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">dm</span><span class="p">[</span><span class="s">&#39;Tsam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>  <span class="c"># or the name of any data source</span>

<span class="ne">NameError</span>: name &#39;dm&#39; is not defined
</pre></div>
</div>
<p>Or bin the data to plot sources against each other...</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [8]: </span><span class="n">binned_data</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">bin_on</span><span class="p">(</span><span class="s">&#39;point_det&#39;</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-8-5b651beb765a&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">binned_data</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">bin_on</span><span class="p">(</span><span class="s">&#39;point_det&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;dm&#39; is not defined

<span class="gp">In [9]: </span><span class="n">binned_data</span>
<span class="go">                                                                                                                                                                                                                                                                                       ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-9-30d1318b2999&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 binned_data</span>

<span class="go">NameError: name &#39;binned_data&#39; is not defined</span>

<span class="gp">In [10]: </span><span class="n">binned_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&#39;Tsam&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&#39;point_det&#39;</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-10-0b810db50efb&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 binned_data.plot(x=&#39;Tsam&#39;, y=&#39;point_det&#39;)</span>

<span class="go">NameError: name &#39;binned_data&#39; is not defined</span>
</pre></div>
</div>
<p>And you can easily export to common formats. Among them:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [11]: </span><span class="n">binned_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">&#39;myfile.csv&#39;</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-11-4dc5892d59db&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">binned_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">&#39;myfile.csv&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;binned_data&#39; is not defined

<span class="gp">In [12]: </span><span class="n">binned_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s">&#39;myfile.xlsx&#39;</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                             ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-12-d90efd455eff&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 binned_data.to_excel(&#39;myfile.xlsx&#39;)</span>

<span class="go">NameError: name &#39;binned_data&#39; is not defined</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-example-plotting-the-most-recent-scan">
<h2>Basic Example: Plotting The Most Recent Scan<a class="headerlink" href="#basic-example-plotting-the-most-recent-scan" title="Permalink to this headline">¶</a></h2>
<div class="section" id="looking-at-a-scan">
<h3>Looking at a Scan<a class="headerlink" href="#looking-at-a-scan" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s inspect the most recent run. To get the Nth most recent run,
type <tt class="docutils literal"><span class="pre">DataBroker[-N]</span></tt>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [13]: </span><span class="kn">from</span> <span class="nn">dataportal.broker</span> <span class="kn">import</span> <span class="n">DataBroker</span>

<span class="gp">In [14]: </span><span class="n">header</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AutoReconnect</span><span class="g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__init__</span><span class="nt">(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">365</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">366</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_connected</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">367</span>             <span class="k">except</span> <span class="n">AutoReconnect</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">_ensure_connected</span><span class="nt">(self, sync)</span>
<span class="g-Whitespace">    </span><span class="mi">929</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">930</span><span class="sd">         self.__ensure_member()</span>
<span class="g-Whitespace">    </span><span class="mi">931</span><span class="sd"> </span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__ensure_member</span><span class="nt">(self)</span>
<span class="g-Whitespace">    </span><span class="mi">802</span><span class="sd">                 try:</span>
<span class="ne">--&gt; </span><span class="mi">803</span><span class="sd">                     member, nodes = self.__find_node()</span>
<span class="g-Whitespace">    </span><span class="mi">804</span><span class="sd">                     return member</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__find_node</span><span class="nt">(self)</span>
<span class="g-Whitespace">    </span><span class="mi">893</span><span class="sd">             # Couldn&#39;t find a suitable host.</span>
<span class="ne">--&gt; </span><span class="mi">894</span><span class="sd">             raise AutoReconnect(&#39;, &#39;.join(errors))</span>
<span class="g-Whitespace">    </span><span class="mi">895</span><span class="sd"> </span>

<span class="ne">AutoReconnect</span>: [Errno 61] Connection refused

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="ne">ConnectionFailure</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">get_connection</span><span class="nt">(alias, reconnect)</span>
<span class="g-Whitespace">    </span><span class="mi">121</span><span class="sd">         try:</span>
<span class="ne">--&gt; </span><span class="mi">122</span><span class="sd">             _connections[alias] = connection_class(**conn_settings)</span>
<span class="g-Whitespace">    </span><span class="mi">123</span><span class="sd">         except Exception as e:</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__init__</span><span class="nt">(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">368</span><span class="sd">                 # ConnectionFailure makes more sense here than AutoReconnect</span>
<span class="ne">--&gt; </span><span class="mi">369</span><span class="sd">                 raise ConnectionFailure(str(e))</span>
<span class="g-Whitespace">    </span><span class="mi">370</span><span class="sd"> </span>

<span class="ne">ConnectionFailure</span>: [Errno 61] Connection refused

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="ne">ConnectionError</span><span class="g-Whitespace">                           </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-14-7b3cc0ce866a&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span><span class="sd"> header = DataBroker[-1]</span>

<span class="nn">/Users/dallan/Documents/Repos/databroker/databroker/databroker.py</span> in <span class="ni">__getitem__</span><span class="nt">(self, key)</span>
<span class="g-Whitespace">     </span><span class="mi">62</span><span class="sd">             else:</span>
<span class="g-Whitespace">     </span><span class="mi">63</span><span class="sd">                 # Interpret key as the Nth last scan.</span>
<span class="ne">---&gt; </span><span class="mi">64</span><span class="sd">                 gen = find_last(-key)</span>
<span class="g-Whitespace">     </span><span class="mi">65</span><span class="sd">                 for i in range(-key):</span>
<span class="g-Whitespace">     </span><span class="mi">66</span><span class="sd">                     try:</span>

<span class="nn">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py</span> in <span class="ni">inner</span><span class="nt">(*args, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">117</span><span class="sd">         host = conf.connection_config[&#39;host&#39;]</span>
<span class="g-Whitespace">    </span><span class="mi">118</span><span class="sd">         port = int(conf.connection_config[&#39;port&#39;])</span>
<span class="ne">--&gt; </span><span class="mi">119</span><span class="sd">         db_connect(database=database, host=host, port=port)</span>
<span class="g-Whitespace">    </span><span class="mi">120</span><span class="sd">         return func(*args, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">121</span><span class="sd">     return inner</span>

<span class="nn">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py</span> in <span class="ni">db_connect</span><span class="nt">(database, host, port)</span>
<span class="g-Whitespace">     </span><span class="mi">96</span><span class="sd">        re-connect.</span>
<span class="g-Whitespace">     </span><span class="mi">97</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">98</span>     <span class="k">return</span> <span class="n">connect</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="n">ALIAS</span><span class="p">)</span>
<span class="g-Whitespace">     </span><span class="mi">99</span> 
<span class="g-Whitespace">    </span><span class="mi">100</span> 

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">connect</span><span class="nt">(db, alias, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">159</span>         <span class="n">register_connection</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">160</span> 
<span class="ne">--&gt; </span><span class="mi">161</span>     <span class="k">return</span> <span class="n">get_connection</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">162</span> 
<span class="g-Whitespace">    </span><span class="mi">163</span> 

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">get_connection</span><span class="nt">(alias, reconnect)</span>
<span class="g-Whitespace">    </span><span class="mi">122</span>             <span class="n">_connections</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection_class</span><span class="p">(</span><span class="o">**</span><span class="n">conn_settings</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">123</span>         <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">124</span>             <span class="k">raise</span> <span class="n">ConnectionError</span><span class="p">(</span><span class="s">&quot;Cannot connect to database </span><span class="si">%s</span><span class="s"> :</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
<span class="g-Whitespace">    </span><span class="mi">125</span>     <span class="k">return</span> <span class="n">_connections</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span>
<span class="g-Whitespace">    </span><span class="mi">126</span> 

<span class="ne">ConnectionError</span>: Cannot connect to database mds :
<span class="p">[</span><span class="n">Errno</span> <span class="mi">61</span><span class="p">]</span> <span class="n">Connection</span> <span class="n">refused</span>
</pre></div>
</div>
<p>What we get is a Header, a dictionary-like (for C programmers, struct-like)
object with all the information pertaining to a run.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [15]: </span><span class="n">header</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-15-71a15b456dab&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">header</span>

<span class="ne">NameError</span>: name &#39;header&#39; is not defined
</pre></div>
</div>
<p>We can view its complete contents with <tt class="docutils literal"><span class="pre">print</span></tt> or, equivalently,
<tt class="docutils literal"><span class="pre">str(header)</span></tt>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [16]: </span><span class="k">print</span> <span class="n">header</span>
<span class="gt">  File</span><span class="nn"> &quot;&lt;ipython-input-16-1f06858d6d82&gt;&quot;</span><span class="gt">, line </span><span class="mi">1</span>
    <span class="k">print</span> <span class="n">header</span>
               <span class="o">^</span>
<span class="ne">SyntaxError</span>: Missing parentheses in call to &#39;print&#39;
</pre></div>
</div>
<p>You can access the contents like a Python dictionary</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [17]: </span><span class="n">header</span><span class="p">[</span><span class="s">&#39;owner&#39;</span><span class="p">]</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-17-0ca857377bba&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;owner&#39;</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;header&#39; is not defined
</pre></div>
</div>
<p>or, equivalently, an attribute. In IPython, use tab-completion to explore.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [18]: </span><span class="n">header</span><span class="o">.</span><span class="n">owner</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-18-64f2d83cbc3d&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">header</span><span class="o">.</span><span class="n">owner</span>

<span class="ne">NameError</span>: name &#39;header&#39; is not defined
</pre></div>
</div>
</div>
<div class="section" id="getting-the-data-in-its-rawest-form">
<h3>Getting the Data in its Rawest Form<a class="headerlink" href="#getting-the-data-in-its-rawest-form" title="Permalink to this headline">¶</a></h3>
<p>The Header does not contain any of the actual measurements from a run. To get
the data itself, pass <tt class="docutils literal"><span class="pre">header</span></tt> (or a list of several Headers) to <tt class="docutils literal"><span class="pre">fetch_events</span></tt>:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [19]: </span><span class="n">events</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="o">.</span><span class="n">fetch_events</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-19-8927db3c3d9f&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">events</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="o">.</span><span class="n">fetch_events</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;header&#39; is not defined
</pre></div>
</div>
<p>The result is a list of Events, each one representing a measurement or
measurements that took place at a given time. (Exactly what we mean
by &#8220;Event&#8221; and &#8220;a given time&#8221; is documented elsewhere in both medium and
excruciating detail.)</p>
<p>Consider this an intermediate step. The data is structured in a generic way
that is wonderfully fleixble but not especially convenient. To get a more
useful view of the data, read on.</p>
</div>
<div class="section" id="putting-the-data-into-a-more-useful-form">
<h3>Putting the Data into a More Useful Form<a class="headerlink" href="#putting-the-data-into-a-more-useful-form" title="Permalink to this headline">¶</a></h3>
<p>One level above the DataBroker sits the DataMuxer, an object for merging and
aligning streams of Events from mamy sources into a table. Build a DataMuxer
like so:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [20]: </span><span class="kn">from</span> <span class="nn">dataportal.muxer</span> <span class="kn">import</span> <span class="n">DataMuxer</span>

<span class="gp">In [21]: </span><span class="n">dm</span> <span class="o">=</span> <span class="n">DataMuxer</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-21-3cf5850c05d5&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">dm</span> <span class="o">=</span> <span class="n">DataMuxer</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;events&#39; is not defined
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">events</span></tt> can be from one scan or from many scans together. Then, the
simplest task is to simply look at the data from one source &#8211; say, sample
temperature.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [22]: </span><span class="n">dm</span><span class="p">[</span><span class="s">&#39;Tsam&#39;</span><span class="p">]</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-22-caacaf9fabf5&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">dm</span><span class="p">[</span><span class="s">&#39;Tsam&#39;</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;dm&#39; is not defined
</pre></div>
</div>
<p>Incidentally, to save a litte typing, <tt class="docutils literal"><span class="pre">dm.Tsam</span></tt> accomplishes the same thing.
At any rate, the output gives the measured data at each time.</p>
<p>Next, let&#8217;s obtain a table showing data from multiple sources. Strictly
speaking, measurements recorded by different equipment are not in general
synchronized, but in practice one usually ignores small differences in time.
For instance, we might want to plot &#8220;temperature&#8221; versus &#8220;intensity&#8221; even if
the temperature and intesity sensors never happened to take a simultaneous
measurement. Doing so, we would be implicitly <em>binning</em> those measurements
in time.</p>
<p>Therefore, plotting one dependent variable against another usually requires
binning to effectively &#8220;align&#8221; the measurements against each other in time.
This is the problem that DataMuxer is designed to solve. On the simplest level,
it takes the stream of events and creates the table of data you probably
expected in the first place. But it is also capable of fully exploiting the
asynchronous stream of measurements, grouping them in different ways to answer
different questions.</p>
<p>To begin, we bin the data by centering one bin at each  <tt class="docutils literal"><span class="pre">point_det</span></tt>
measurement.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [23]: </span><span class="n">binned_data</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">bin_on</span><span class="p">(</span><span class="s">&#39;point_det&#39;</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-23-5b651beb765a&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">binned_data</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">bin_on</span><span class="p">(</span><span class="s">&#39;point_det&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;dm&#39; is not defined

<span class="gp">In [24]: </span><span class="n">binned_data</span>
<span class="go">                                                                                                                                                                                                                                                                                        ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-24-30d1318b2999&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 binned_data</span>

<span class="go">NameError: name &#39;binned_data&#39; is not defined</span>
</pre></div>
</div>
<p>Wherever there is <tt class="docutils literal"><span class="pre">point_det</span></tt> measurement but no <tt class="docutils literal"><span class="pre">Tsam</span></tt> measurement within
the time window, NaN indicates the missing data. (You may object that &#8220;NaN&#8221;
is not really the same as &#8220;missing.&#8221; This is a convention borrowed from the
widely-used pandas package, and the reasons for using NaN to mean &#8220;missing&#8221;
have to do with the limitations of numpy in handling missing data.)</p>
<p>The <tt class="docutils literal"><span class="pre">count</span></tt> sub-column indicates the number of <tt class="docutils literal"><span class="pre">Tsam</span></tt> measurements in
each bin. There is exactly one <tt class="docutils literal"><span class="pre">point_det</span></tt> measurement in every bin, by
definition, so no <tt class="docutils literal"><span class="pre">count</span></tt> is shown there.</p>
<p>Sometimes, one can interpolate the missing values according to some rule, such
as linear interpolation.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [25]: </span><span class="n">binned_data</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">bin_on</span><span class="p">(</span><span class="s">&#39;point_det&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;Tsam&#39;</span><span class="p">:</span> <span class="s">&#39;linear&#39;</span><span class="p">})</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-25-75376ab7c551&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">binned_data</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">bin_on</span><span class="p">(</span><span class="s">&#39;point_det&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;Tsam&#39;</span><span class="p">:</span> <span class="s">&#39;linear&#39;</span><span class="p">})</span>

<span class="ne">NameError</span>: name &#39;dm&#39; is not defined

<span class="gp">In [26]: </span><span class="n">binned_data</span>
<span class="go">                                                                                                                                                                                                                                                                                                                          ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-26-30d1318b2999&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 binned_data</span>

<span class="go">NameError: name &#39;binned_data&#39; is not defined</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">count</span></tt> column, still present, indicates which values are measured (1)
and which are interpolated (0).</p>
<p>If instead we bin the other way, defining one bin per <tt class="docutils literal"><span class="pre">Tsam</span></tt> data point,
we must provide a rule for combining multiple <tt class="docutils literal"><span class="pre">point_det</span></tt> measurements in
the same bin into one representative value. Now, along with the <tt class="docutils literal"><span class="pre">count</span></tt>
sub-column, other summary statistics are automatically generated.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [27]: </span><span class="n">binned_data</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">bin_on</span><span class="p">(</span><span class="s">&#39;Tsam&#39;</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;point_det&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">})</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-27-0dc2b0e44a8f&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">binned_data</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">bin_on</span><span class="p">(</span><span class="s">&#39;Tsam&#39;</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;point_det&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">})</span>

<span class="ne">NameError</span>: name &#39;dm&#39; is not defined

<span class="gp">In [28]: </span><span class="n">binned_data</span>
<span class="go">                                                                                                                                                                                                                                                                                                               ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-28-30d1318b2999&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 binned_data</span>

<span class="go">NameError: name &#39;binned_data&#39; is not defined</span>
</pre></div>
</div>
<p>To discard the extra statistics and keep the values only, use this syntax.
(<tt class="docutils literal"><span class="pre">xs</span></tt> stands for cross-section, a sophisticated pandas method.)</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [29]: </span><span class="n">binned_data</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s">&#39;val&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-29-86beb7b60a6d&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">binned_data</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s">&#39;val&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;binned_data&#39; is not defined
</pre></div>
</div>
</div>
<div class="section" id="exporting-the-data-for-use-outside-of-python">
<h3>Exporting the Data for Use Outside of Python<a class="headerlink" href="#exporting-the-data-for-use-outside-of-python" title="Permalink to this headline">¶</a></h3>
<p>The tabular results from the DataMuxer are DataFrames, objects from the widely-
used and well-documented package pandas, and there are many convenient
methods for exporting them to common formats. For example:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [30]: </span><span class="n">binned_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">&#39;myfile.csv&#39;</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-30-4dc5892d59db&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">binned_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">&#39;myfile.csv&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;binned_data&#39; is not defined

<span class="gp">In [31]: </span><span class="n">binned_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s">&#39;myfile.xlsx&#39;</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                             ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-31-d90efd455eff&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 binned_data.to_excel(&#39;myfile.xlsx&#39;)</span>

<span class="go">NameError: name &#39;binned_data&#39; is not defined</span>
</pre></div>
</div>
<p>More methods are described in the pandas documention, and can easily be
explored by typing <tt class="docutils literal"><span class="pre">binned_data.to_</span></tt> &lt;tab&gt;.</p>
<p>This quick-and-dirty export is really only useful if the data of interest
is scalar (e.g., not images) and not very large. For other applications,
different tools should be used. As of this writing, these tools are in
development and not yet documented.</p>
</div>
</div>
<div class="section" id="more-ways-to-look-up-scans">
<h2>More Ways to Look Up Scans<a class="headerlink" href="#more-ways-to-look-up-scans" title="Permalink to this headline">¶</a></h2>
<p>To quickly look up recent scans, use the standard Python slicing syntax for
indexing from the end of a list.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [32]: </span><span class="n">header</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># most recent scan</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AutoReconnect</span><span class="g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__init__</span><span class="nt">(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">365</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">366</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_connected</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">367</span>             <span class="k">except</span> <span class="n">AutoReconnect</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">_ensure_connected</span><span class="nt">(self, sync)</span>
<span class="g-Whitespace">    </span><span class="mi">929</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">930</span><span class="sd">         self.__ensure_member()</span>
<span class="g-Whitespace">    </span><span class="mi">931</span><span class="sd"> </span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__ensure_member</span><span class="nt">(self)</span>
<span class="g-Whitespace">    </span><span class="mi">802</span><span class="sd">                 try:</span>
<span class="ne">--&gt; </span><span class="mi">803</span><span class="sd">                     member, nodes = self.__find_node()</span>
<span class="g-Whitespace">    </span><span class="mi">804</span><span class="sd">                     return member</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__find_node</span><span class="nt">(self)</span>
<span class="g-Whitespace">    </span><span class="mi">893</span><span class="sd">             # Couldn&#39;t find a suitable host.</span>
<span class="ne">--&gt; </span><span class="mi">894</span><span class="sd">             raise AutoReconnect(&#39;, &#39;.join(errors))</span>
<span class="g-Whitespace">    </span><span class="mi">895</span><span class="sd"> </span>

<span class="ne">AutoReconnect</span>: [Errno 61] Connection refused

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="ne">ConnectionFailure</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">get_connection</span><span class="nt">(alias, reconnect)</span>
<span class="g-Whitespace">    </span><span class="mi">121</span><span class="sd">         try:</span>
<span class="ne">--&gt; </span><span class="mi">122</span><span class="sd">             _connections[alias] = connection_class(**conn_settings)</span>
<span class="g-Whitespace">    </span><span class="mi">123</span><span class="sd">         except Exception as e:</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__init__</span><span class="nt">(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">368</span><span class="sd">                 # ConnectionFailure makes more sense here than AutoReconnect</span>
<span class="ne">--&gt; </span><span class="mi">369</span><span class="sd">                 raise ConnectionFailure(str(e))</span>
<span class="g-Whitespace">    </span><span class="mi">370</span><span class="sd"> </span>

<span class="ne">ConnectionFailure</span>: [Errno 61] Connection refused

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="ne">ConnectionError</span><span class="g-Whitespace">                           </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-32-1b16e9bd6325&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span><span class="sd"> header = DataBroker[-1]  # most recent scan</span>

<span class="nn">/Users/dallan/Documents/Repos/databroker/databroker/databroker.py</span> in <span class="ni">__getitem__</span><span class="nt">(self, key)</span>
<span class="g-Whitespace">     </span><span class="mi">62</span><span class="sd">             else:</span>
<span class="g-Whitespace">     </span><span class="mi">63</span><span class="sd">                 # Interpret key as the Nth last scan.</span>
<span class="ne">---&gt; </span><span class="mi">64</span><span class="sd">                 gen = find_last(-key)</span>
<span class="g-Whitespace">     </span><span class="mi">65</span><span class="sd">                 for i in range(-key):</span>
<span class="g-Whitespace">     </span><span class="mi">66</span><span class="sd">                     try:</span>

<span class="nn">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py</span> in <span class="ni">inner</span><span class="nt">(*args, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">117</span><span class="sd">         host = conf.connection_config[&#39;host&#39;]</span>
<span class="g-Whitespace">    </span><span class="mi">118</span><span class="sd">         port = int(conf.connection_config[&#39;port&#39;])</span>
<span class="ne">--&gt; </span><span class="mi">119</span><span class="sd">         db_connect(database=database, host=host, port=port)</span>
<span class="g-Whitespace">    </span><span class="mi">120</span><span class="sd">         return func(*args, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">121</span><span class="sd">     return inner</span>

<span class="nn">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py</span> in <span class="ni">db_connect</span><span class="nt">(database, host, port)</span>
<span class="g-Whitespace">     </span><span class="mi">96</span><span class="sd">        re-connect.</span>
<span class="g-Whitespace">     </span><span class="mi">97</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">98</span>     <span class="k">return</span> <span class="n">connect</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="n">ALIAS</span><span class="p">)</span>
<span class="g-Whitespace">     </span><span class="mi">99</span> 
<span class="g-Whitespace">    </span><span class="mi">100</span> 

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">connect</span><span class="nt">(db, alias, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">159</span>         <span class="n">register_connection</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">160</span> 
<span class="ne">--&gt; </span><span class="mi">161</span>     <span class="k">return</span> <span class="n">get_connection</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">162</span> 
<span class="g-Whitespace">    </span><span class="mi">163</span> 

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">get_connection</span><span class="nt">(alias, reconnect)</span>
<span class="g-Whitespace">    </span><span class="mi">122</span>             <span class="n">_connections</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection_class</span><span class="p">(</span><span class="o">**</span><span class="n">conn_settings</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">123</span>         <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">124</span>             <span class="k">raise</span> <span class="n">ConnectionError</span><span class="p">(</span><span class="s">&quot;Cannot connect to database </span><span class="si">%s</span><span class="s"> :</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
<span class="g-Whitespace">    </span><span class="mi">125</span>     <span class="k">return</span> <span class="n">_connections</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span>
<span class="g-Whitespace">    </span><span class="mi">126</span> 

<span class="ne">ConnectionError</span>: Cannot connect to database mds :
<span class="p">[</span><span class="n">Errno</span> <span class="mi">61</span><span class="p">]</span> <span class="n">Connection</span> <span class="n">refused</span>

<span class="gp">In [33]: </span><span class="n">header</span><span class="o">.</span><span class="n">scan_id</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-33-568d15f1f12c&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 header.scan_id</span>

<span class="go">NameError: name &#39;header&#39; is not defined</span>

<span class="gp">In [34]: </span><span class="n">header</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="c"># next to last scan</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ---------------------------------------------------------------------------</span>
<span class="go">AutoReconnect                             Traceback (most recent call last)</span>
<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __init__(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="go">    365             try:</span>
<span class="go">--&gt; 366                 self._ensure_connected(True)</span>
<span class="go">    367             except AutoReconnect as e:</span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in _ensure_connected(self, sync)</span>
<span class="go">    929         &quot;&quot;&quot;</span>
<span class="go">--&gt; 930         self.__ensure_member()</span>
<span class="go">    931 </span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __ensure_member(self)</span>
<span class="go">    802                 try:</span>
<span class="go">--&gt; 803                     member, nodes = self.__find_node()</span>
<span class="go">    804                     return member</span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __find_node(self)</span>
<span class="go">    893             # Couldn&#39;t find a suitable host.</span>
<span class="go">--&gt; 894             raise AutoReconnect(&#39;, &#39;.join(errors))</span>
<span class="go">    895 </span>

<span class="go">AutoReconnect: [Errno 61] Connection refused</span>

<span class="go">During handling of the above exception, another exception occurred:</span>

<span class="go">ConnectionFailure                         Traceback (most recent call last)</span>
<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py in get_connection(alias, reconnect)</span>
<span class="go">    121         try:</span>
<span class="go">--&gt; 122             _connections[alias] = connection_class(**conn_settings)</span>
<span class="go">    123         except Exception as e:</span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __init__(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="go">    368                 # ConnectionFailure makes more sense here than AutoReconnect</span>
<span class="go">--&gt; 369                 raise ConnectionFailure(str(e))</span>
<span class="go">    370 </span>

<span class="go">ConnectionFailure: [Errno 61] Connection refused</span>

<span class="go">During handling of the above exception, another exception occurred:</span>

<span class="go">ConnectionError                           Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-34-36cc6e9f562c&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 header = DataBroker[-2]  # next to last scan</span>

<span class="go">/Users/dallan/Documents/Repos/databroker/databroker/databroker.py in __getitem__(self, key)</span>
<span class="go">     62             else:</span>
<span class="go">     63                 # Interpret key as the Nth last scan.</span>
<span class="go">---&gt; 64                 gen = find_last(-key)</span>
<span class="go">     65                 for i in range(-key):</span>
<span class="go">     66                     try:</span>

<span class="go">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py in inner(*args, **kwargs)</span>
<span class="go">    117         host = conf.connection_config[&#39;host&#39;]</span>
<span class="go">    118         port = int(conf.connection_config[&#39;port&#39;])</span>
<span class="go">--&gt; 119         db_connect(database=database, host=host, port=port)</span>
<span class="go">    120         return func(*args, **kwargs)</span>
<span class="go">    121     return inner</span>

<span class="go">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py in db_connect(database, host, port)</span>
<span class="go">     96        re-connect.</span>
<span class="go">     97     &quot;&quot;&quot;</span>
<span class="go">---&gt; 98     return connect(db=database, host=host, port=port, alias=ALIAS)</span>
<span class="go">     99 </span>
<span class="go">    100 </span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py in connect(db, alias, **kwargs)</span>
<span class="go">    159         register_connection(alias, db, **kwargs)</span>
<span class="go">    160 </span>
<span class="go">--&gt; 161     return get_connection(alias)</span>
<span class="go">    162 </span>
<span class="go">    163 </span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py in get_connection(alias, reconnect)</span>
<span class="go">    122             _connections[alias] = connection_class(**conn_settings)</span>
<span class="go">    123         except Exception as e:</span>
<span class="go">--&gt; 124             raise ConnectionError(&quot;Cannot connect to database %s :\n%s&quot; % (alias, e))</span>
<span class="go">    125     return _connections[alias]</span>
<span class="go">    126 </span>

<span class="go">ConnectionError: Cannot connect to database mds :</span>
<span class="go">[Errno 61] Connection refused</span>

<span class="gp">In [35]: </span><span class="n">header</span><span class="o">.</span><span class="n">scan_id</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-35-568d15f1f12c&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 header.scan_id</span>

<span class="go">NameError: name &#39;header&#39; is not defined</span>

<span class="gp">In [36]: </span><span class="n">headers</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>  <span class="c"># all of the last five scans</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ---------------------------------------------------------------------------</span>
<span class="go">AutoReconnect                             Traceback (most recent call last)</span>
<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __init__(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="go">    365             try:</span>
<span class="go">--&gt; 366                 self._ensure_connected(True)</span>
<span class="go">    367             except AutoReconnect as e:</span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in _ensure_connected(self, sync)</span>
<span class="go">    929         &quot;&quot;&quot;</span>
<span class="go">--&gt; 930         self.__ensure_member()</span>
<span class="go">    931 </span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __ensure_member(self)</span>
<span class="go">    802                 try:</span>
<span class="go">--&gt; 803                     member, nodes = self.__find_node()</span>
<span class="go">    804                     return member</span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __find_node(self)</span>
<span class="go">    893             # Couldn&#39;t find a suitable host.</span>
<span class="go">--&gt; 894             raise AutoReconnect(&#39;, &#39;.join(errors))</span>
<span class="go">    895 </span>

<span class="go">AutoReconnect: [Errno 61] Connection refused</span>

<span class="go">During handling of the above exception, another exception occurred:</span>

<span class="go">ConnectionFailure                         Traceback (most recent call last)</span>
<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py in get_connection(alias, reconnect)</span>
<span class="go">    121         try:</span>
<span class="go">--&gt; 122             _connections[alias] = connection_class(**conn_settings)</span>
<span class="go">    123         except Exception as e:</span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __init__(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="go">    368                 # ConnectionFailure makes more sense here than AutoReconnect</span>
<span class="go">--&gt; 369                 raise ConnectionFailure(str(e))</span>
<span class="go">    370 </span>

<span class="go">ConnectionFailure: [Errno 61] Connection refused</span>

<span class="go">During handling of the above exception, another exception occurred:</span>

<span class="go">ConnectionError                           Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-36-66263b397751&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 headers = DataBroker[-5:]  # all of the last five scans</span>

<span class="go">/Users/dallan/Documents/Repos/databroker/databroker/databroker.py in __getitem__(self, key)</span>
<span class="go">     48                                  &quot;and could become too large.&quot;)</span>
<span class="go">     49             start = -key.start</span>
<span class="go">---&gt; 50             result = list(find_last(start))[stop::key.step]</span>
<span class="go">     51             header = [Header.from_run_start(h) for h in result]</span>
<span class="go">     52         elif isinstance(key, int):</span>

<span class="go">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py in inner(*args, **kwargs)</span>
<span class="go">    117         host = conf.connection_config[&#39;host&#39;]</span>
<span class="go">    118         port = int(conf.connection_config[&#39;port&#39;])</span>
<span class="go">--&gt; 119         db_connect(database=database, host=host, port=port)</span>
<span class="go">    120         return func(*args, **kwargs)</span>
<span class="go">    121     return inner</span>

<span class="go">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py in db_connect(database, host, port)</span>
<span class="go">     96        re-connect.</span>
<span class="go">     97     &quot;&quot;&quot;</span>
<span class="go">---&gt; 98     return connect(db=database, host=host, port=port, alias=ALIAS)</span>
<span class="go">     99 </span>
<span class="go">    100 </span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py in connect(db, alias, **kwargs)</span>
<span class="go">    159         register_connection(alias, db, **kwargs)</span>
<span class="go">    160 </span>
<span class="go">--&gt; 161     return get_connection(alias)</span>
<span class="go">    162 </span>
<span class="go">    163 </span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py in get_connection(alias, reconnect)</span>
<span class="go">    122             _connections[alias] = connection_class(**conn_settings)</span>
<span class="go">    123         except Exception as e:</span>
<span class="go">--&gt; 124             raise ConnectionError(&quot;Cannot connect to database %s :\n%s&quot; % (alias, e))</span>
<span class="go">    125     return _connections[alias]</span>
<span class="go">    126 </span>

<span class="go">ConnectionError: Cannot connect to database mds :</span>
<span class="go">[Errno 61] Connection refused</span>

<span class="gp">In [37]: </span><span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">scan_id</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">]</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-37-1750a6cb737b&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 [h.scan_id for h in headers]</span>

<span class="go">NameError: name &#39;headers&#39; is not defined</span>

<span class="gp">In [38]: </span><span class="n">headers</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">::</span><span class="mi">100</span><span class="p">]</span>  <span class="c"># sample every 100th of the last (up to) 1000 scans</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ---------------------------------------------------------------------------</span>
<span class="go">AutoReconnect                             Traceback (most recent call last)</span>
<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __init__(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="go">    365             try:</span>
<span class="go">--&gt; 366                 self._ensure_connected(True)</span>
<span class="go">    367             except AutoReconnect as e:</span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in _ensure_connected(self, sync)</span>
<span class="go">    929         &quot;&quot;&quot;</span>
<span class="go">--&gt; 930         self.__ensure_member()</span>
<span class="go">    931 </span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __ensure_member(self)</span>
<span class="go">    802                 try:</span>
<span class="go">--&gt; 803                     member, nodes = self.__find_node()</span>
<span class="go">    804                     return member</span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __find_node(self)</span>
<span class="go">    893             # Couldn&#39;t find a suitable host.</span>
<span class="go">--&gt; 894             raise AutoReconnect(&#39;, &#39;.join(errors))</span>
<span class="go">    895 </span>

<span class="go">AutoReconnect: [Errno 61] Connection refused</span>

<span class="go">During handling of the above exception, another exception occurred:</span>

<span class="go">ConnectionFailure                         Traceback (most recent call last)</span>
<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py in get_connection(alias, reconnect)</span>
<span class="go">    121         try:</span>
<span class="go">--&gt; 122             _connections[alias] = connection_class(**conn_settings)</span>
<span class="go">    123         except Exception as e:</span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __init__(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="go">    368                 # ConnectionFailure makes more sense here than AutoReconnect</span>
<span class="go">--&gt; 369                 raise ConnectionFailure(str(e))</span>
<span class="go">    370 </span>

<span class="go">ConnectionFailure: [Errno 61] Connection refused</span>

<span class="go">During handling of the above exception, another exception occurred:</span>

<span class="go">ConnectionError                           Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-38-22adee37494e&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 headers = DataBroker[-1000::100]  # sample every 100th of the last (up to) 1000 scans</span>

<span class="go">/Users/dallan/Documents/Repos/databroker/databroker/databroker.py in __getitem__(self, key)</span>
<span class="go">     48                                  &quot;and could become too large.&quot;)</span>
<span class="go">     49             start = -key.start</span>
<span class="go">---&gt; 50             result = list(find_last(start))[stop::key.step]</span>
<span class="go">     51             header = [Header.from_run_start(h) for h in result]</span>
<span class="go">     52         elif isinstance(key, int):</span>

<span class="go">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py in inner(*args, **kwargs)</span>
<span class="go">    117         host = conf.connection_config[&#39;host&#39;]</span>
<span class="go">    118         port = int(conf.connection_config[&#39;port&#39;])</span>
<span class="go">--&gt; 119         db_connect(database=database, host=host, port=port)</span>
<span class="go">    120         return func(*args, **kwargs)</span>
<span class="go">    121     return inner</span>

<span class="go">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py in db_connect(database, host, port)</span>
<span class="go">     96        re-connect.</span>
<span class="go">     97     &quot;&quot;&quot;</span>
<span class="go">---&gt; 98     return connect(db=database, host=host, port=port, alias=ALIAS)</span>
<span class="go">     99 </span>
<span class="go">    100 </span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py in connect(db, alias, **kwargs)</span>
<span class="go">    159         register_connection(alias, db, **kwargs)</span>
<span class="go">    160 </span>
<span class="go">--&gt; 161     return get_connection(alias)</span>
<span class="go">    162 </span>
<span class="go">    163 </span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py in get_connection(alias, reconnect)</span>
<span class="go">    122             _connections[alias] = connection_class(**conn_settings)</span>
<span class="go">    123         except Exception as e:</span>
<span class="go">--&gt; 124             raise ConnectionError(&quot;Cannot connect to database %s :\n%s&quot; % (alias, e))</span>
<span class="go">    125     return _connections[alias]</span>
<span class="go">    126 </span>

<span class="go">ConnectionError: Cannot connect to database mds :</span>
<span class="go">[Errno 61] Connection refused</span>
</pre></div>
</div>
<p>Or give the scan ID, which is always a positive integer.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [39]: </span><span class="n">header</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>  <span class="c"># scan ID 4</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AutoReconnect</span><span class="g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__init__</span><span class="nt">(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">365</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">366</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_connected</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">367</span>             <span class="k">except</span> <span class="n">AutoReconnect</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">_ensure_connected</span><span class="nt">(self, sync)</span>
<span class="g-Whitespace">    </span><span class="mi">929</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">930</span><span class="sd">         self.__ensure_member()</span>
<span class="g-Whitespace">    </span><span class="mi">931</span><span class="sd"> </span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__ensure_member</span><span class="nt">(self)</span>
<span class="g-Whitespace">    </span><span class="mi">802</span><span class="sd">                 try:</span>
<span class="ne">--&gt; </span><span class="mi">803</span><span class="sd">                     member, nodes = self.__find_node()</span>
<span class="g-Whitespace">    </span><span class="mi">804</span><span class="sd">                     return member</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__find_node</span><span class="nt">(self)</span>
<span class="g-Whitespace">    </span><span class="mi">893</span><span class="sd">             # Couldn&#39;t find a suitable host.</span>
<span class="ne">--&gt; </span><span class="mi">894</span><span class="sd">             raise AutoReconnect(&#39;, &#39;.join(errors))</span>
<span class="g-Whitespace">    </span><span class="mi">895</span><span class="sd"> </span>

<span class="ne">AutoReconnect</span>: [Errno 61] Connection refused

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="ne">ConnectionFailure</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">get_connection</span><span class="nt">(alias, reconnect)</span>
<span class="g-Whitespace">    </span><span class="mi">121</span><span class="sd">         try:</span>
<span class="ne">--&gt; </span><span class="mi">122</span><span class="sd">             _connections[alias] = connection_class(**conn_settings)</span>
<span class="g-Whitespace">    </span><span class="mi">123</span><span class="sd">         except Exception as e:</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__init__</span><span class="nt">(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">368</span><span class="sd">                 # ConnectionFailure makes more sense here than AutoReconnect</span>
<span class="ne">--&gt; </span><span class="mi">369</span><span class="sd">                 raise ConnectionFailure(str(e))</span>
<span class="g-Whitespace">    </span><span class="mi">370</span><span class="sd"> </span>

<span class="ne">ConnectionFailure</span>: [Errno 61] Connection refused

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="ne">ConnectionError</span><span class="g-Whitespace">                           </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-39-c42deee19cfc&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span><span class="sd"> header = DataBroker[4]  # scan ID 4</span>

<span class="nn">/Users/dallan/Documents/Repos/databroker/databroker/databroker.py</span> in <span class="ni">__getitem__</span><span class="nt">(self, key)</span>
<span class="g-Whitespace">     </span><span class="mi">53</span><span class="sd">             if key &gt; -1:</span>
<span class="g-Whitespace">     </span><span class="mi">54</span><span class="sd">                 # Interpret key as a scan_id.</span>
<span class="ne">---&gt; </span><span class="mi">55</span><span class="sd">                 gen = find_run_starts(scan_id=key)</span>
<span class="g-Whitespace">     </span><span class="mi">56</span><span class="sd">                 try:</span>
<span class="g-Whitespace">     </span><span class="mi">57</span><span class="sd">                     result = next(gen)  # most recent match</span>

<span class="nn">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py</span> in <span class="ni">inner</span><span class="nt">(*args, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">117</span><span class="sd">         host = conf.connection_config[&#39;host&#39;]</span>
<span class="g-Whitespace">    </span><span class="mi">118</span><span class="sd">         port = int(conf.connection_config[&#39;port&#39;])</span>
<span class="ne">--&gt; </span><span class="mi">119</span><span class="sd">         db_connect(database=database, host=host, port=port)</span>
<span class="g-Whitespace">    </span><span class="mi">120</span><span class="sd">         return func(*args, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">121</span><span class="sd">     return inner</span>

<span class="nn">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py</span> in <span class="ni">db_connect</span><span class="nt">(database, host, port)</span>
<span class="g-Whitespace">     </span><span class="mi">96</span><span class="sd">        re-connect.</span>
<span class="g-Whitespace">     </span><span class="mi">97</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">98</span>     <span class="k">return</span> <span class="n">connect</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="n">ALIAS</span><span class="p">)</span>
<span class="g-Whitespace">     </span><span class="mi">99</span> 
<span class="g-Whitespace">    </span><span class="mi">100</span> 

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">connect</span><span class="nt">(db, alias, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">159</span>         <span class="n">register_connection</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">160</span> 
<span class="ne">--&gt; </span><span class="mi">161</span>     <span class="k">return</span> <span class="n">get_connection</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">162</span> 
<span class="g-Whitespace">    </span><span class="mi">163</span> 

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">get_connection</span><span class="nt">(alias, reconnect)</span>
<span class="g-Whitespace">    </span><span class="mi">122</span>             <span class="n">_connections</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection_class</span><span class="p">(</span><span class="o">**</span><span class="n">conn_settings</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">123</span>         <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">124</span>             <span class="k">raise</span> <span class="n">ConnectionError</span><span class="p">(</span><span class="s">&quot;Cannot connect to database </span><span class="si">%s</span><span class="s"> :</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
<span class="g-Whitespace">    </span><span class="mi">125</span>     <span class="k">return</span> <span class="n">_connections</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span>
<span class="g-Whitespace">    </span><span class="mi">126</span> 

<span class="ne">ConnectionError</span>: Cannot connect to database mds :
<span class="p">[</span><span class="n">Errno</span> <span class="mi">61</span><span class="p">]</span> <span class="n">Connection</span> <span class="n">refused</span>

<span class="gp">In [40]: </span><span class="n">header</span><span class="o">.</span><span class="n">scan_id</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-40-568d15f1f12c&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 header.scan_id</span>

<span class="go">NameError: name &#39;header&#39; is not defined</span>
</pre></div>
</div>
<p>If you know the unique id (uid) of a Header, you can use the first few
characters to find it.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [41]: </span><span class="n">header</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="p">[</span><span class="s">&#39;a5fbde&#39;</span><span class="p">]</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AutoReconnect</span><span class="g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__init__</span><span class="nt">(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">365</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">366</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_connected</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">367</span>             <span class="k">except</span> <span class="n">AutoReconnect</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">_ensure_connected</span><span class="nt">(self, sync)</span>
<span class="g-Whitespace">    </span><span class="mi">929</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">930</span><span class="sd">         self.__ensure_member()</span>
<span class="g-Whitespace">    </span><span class="mi">931</span><span class="sd"> </span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__ensure_member</span><span class="nt">(self)</span>
<span class="g-Whitespace">    </span><span class="mi">802</span><span class="sd">                 try:</span>
<span class="ne">--&gt; </span><span class="mi">803</span><span class="sd">                     member, nodes = self.__find_node()</span>
<span class="g-Whitespace">    </span><span class="mi">804</span><span class="sd">                     return member</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__find_node</span><span class="nt">(self)</span>
<span class="g-Whitespace">    </span><span class="mi">893</span><span class="sd">             # Couldn&#39;t find a suitable host.</span>
<span class="ne">--&gt; </span><span class="mi">894</span><span class="sd">             raise AutoReconnect(&#39;, &#39;.join(errors))</span>
<span class="g-Whitespace">    </span><span class="mi">895</span><span class="sd"> </span>

<span class="ne">AutoReconnect</span>: [Errno 61] Connection refused

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="ne">ConnectionFailure</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">get_connection</span><span class="nt">(alias, reconnect)</span>
<span class="g-Whitespace">    </span><span class="mi">121</span><span class="sd">         try:</span>
<span class="ne">--&gt; </span><span class="mi">122</span><span class="sd">             _connections[alias] = connection_class(**conn_settings)</span>
<span class="g-Whitespace">    </span><span class="mi">123</span><span class="sd">         except Exception as e:</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__init__</span><span class="nt">(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">368</span><span class="sd">                 # ConnectionFailure makes more sense here than AutoReconnect</span>
<span class="ne">--&gt; </span><span class="mi">369</span><span class="sd">                 raise ConnectionFailure(str(e))</span>
<span class="g-Whitespace">    </span><span class="mi">370</span><span class="sd"> </span>

<span class="ne">ConnectionFailure</span>: [Errno 61] Connection refused

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="ne">ConnectionError</span><span class="g-Whitespace">                           </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-41-f24635177cf4&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span><span class="sd"> header = DataBroker[&#39;a5fbde&#39;]</span>

<span class="nn">/Users/dallan/Documents/Repos/databroker/databroker/databroker.py</span> in <span class="ni">__getitem__</span><span class="nt">(self, key)</span>
<span class="g-Whitespace">     </span><span class="mi">81</span><span class="sd">                 # No dice? Try searching as if we have a partial uid.</span>
<span class="g-Whitespace">     </span><span class="mi">82</span><span class="sd">                 logger.debug(&#39;Treating %s as a partial uuid&#39; % key)</span>
<span class="ne">---&gt; </span><span class="mi">83</span><span class="sd">                 gen = find_run_starts(uid={&#39;$regex&#39;: &#39;{0}.*&#39;.format(key)})</span>
<span class="g-Whitespace">     </span><span class="mi">84</span><span class="sd">                 results = list(gen)</span>
<span class="g-Whitespace">     </span><span class="mi">85</span><span class="sd">             if not results:</span>

<span class="nn">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py</span> in <span class="ni">inner</span><span class="nt">(*args, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">117</span><span class="sd">         host = conf.connection_config[&#39;host&#39;]</span>
<span class="g-Whitespace">    </span><span class="mi">118</span><span class="sd">         port = int(conf.connection_config[&#39;port&#39;])</span>
<span class="ne">--&gt; </span><span class="mi">119</span><span class="sd">         db_connect(database=database, host=host, port=port)</span>
<span class="g-Whitespace">    </span><span class="mi">120</span><span class="sd">         return func(*args, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">121</span><span class="sd">     return inner</span>

<span class="nn">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py</span> in <span class="ni">db_connect</span><span class="nt">(database, host, port)</span>
<span class="g-Whitespace">     </span><span class="mi">96</span><span class="sd">        re-connect.</span>
<span class="g-Whitespace">     </span><span class="mi">97</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">98</span>     <span class="k">return</span> <span class="n">connect</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="n">ALIAS</span><span class="p">)</span>
<span class="g-Whitespace">     </span><span class="mi">99</span> 
<span class="g-Whitespace">    </span><span class="mi">100</span> 

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">connect</span><span class="nt">(db, alias, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">159</span>         <span class="n">register_connection</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">160</span> 
<span class="ne">--&gt; </span><span class="mi">161</span>     <span class="k">return</span> <span class="n">get_connection</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">162</span> 
<span class="g-Whitespace">    </span><span class="mi">163</span> 

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">get_connection</span><span class="nt">(alias, reconnect)</span>
<span class="g-Whitespace">    </span><span class="mi">122</span>             <span class="n">_connections</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection_class</span><span class="p">(</span><span class="o">**</span><span class="n">conn_settings</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">123</span>         <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">124</span>             <span class="k">raise</span> <span class="n">ConnectionError</span><span class="p">(</span><span class="s">&quot;Cannot connect to database </span><span class="si">%s</span><span class="s"> :</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
<span class="g-Whitespace">    </span><span class="mi">125</span>     <span class="k">return</span> <span class="n">_connections</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span>
<span class="g-Whitespace">    </span><span class="mi">126</span> 

<span class="ne">ConnectionError</span>: Cannot connect to database mds :
<span class="p">[</span><span class="n">Errno</span> <span class="mi">61</span><span class="p">]</span> <span class="n">Connection</span> <span class="n">refused</span>
</pre></div>
</div>
<p>For advanced searches, use <tt class="docutils literal"><span class="pre">find_headers</span></tt>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [42]: </span><span class="n">neds_headers</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="o">.</span><span class="n">find_headers</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="s">&#39;nedbrainard&#39;</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AutoReconnect</span><span class="g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__init__</span><span class="nt">(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">365</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">366</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_connected</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">367</span>             <span class="k">except</span> <span class="n">AutoReconnect</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">_ensure_connected</span><span class="nt">(self, sync)</span>
<span class="g-Whitespace">    </span><span class="mi">929</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">930</span><span class="sd">         self.__ensure_member()</span>
<span class="g-Whitespace">    </span><span class="mi">931</span><span class="sd"> </span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__ensure_member</span><span class="nt">(self)</span>
<span class="g-Whitespace">    </span><span class="mi">802</span><span class="sd">                 try:</span>
<span class="ne">--&gt; </span><span class="mi">803</span><span class="sd">                     member, nodes = self.__find_node()</span>
<span class="g-Whitespace">    </span><span class="mi">804</span><span class="sd">                     return member</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__find_node</span><span class="nt">(self)</span>
<span class="g-Whitespace">    </span><span class="mi">893</span><span class="sd">             # Couldn&#39;t find a suitable host.</span>
<span class="ne">--&gt; </span><span class="mi">894</span><span class="sd">             raise AutoReconnect(&#39;, &#39;.join(errors))</span>
<span class="g-Whitespace">    </span><span class="mi">895</span><span class="sd"> </span>

<span class="ne">AutoReconnect</span>: [Errno 61] Connection refused

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="ne">ConnectionFailure</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">get_connection</span><span class="nt">(alias, reconnect)</span>
<span class="g-Whitespace">    </span><span class="mi">121</span><span class="sd">         try:</span>
<span class="ne">--&gt; </span><span class="mi">122</span><span class="sd">             _connections[alias] = connection_class(**conn_settings)</span>
<span class="g-Whitespace">    </span><span class="mi">123</span><span class="sd">         except Exception as e:</span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py</span> in <span class="ni">__init__</span><span class="nt">(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">368</span><span class="sd">                 # ConnectionFailure makes more sense here than AutoReconnect</span>
<span class="ne">--&gt; </span><span class="mi">369</span><span class="sd">                 raise ConnectionFailure(str(e))</span>
<span class="g-Whitespace">    </span><span class="mi">370</span><span class="sd"> </span>

<span class="ne">ConnectionFailure</span>: [Errno 61] Connection refused

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="ne">ConnectionError</span><span class="g-Whitespace">                           </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-42-f8ebf66bb11d&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span><span class="sd"> neds_headers = DataBroker.find_headers(owner=&#39;nedbrainard&#39;)</span>

<span class="nn">/Users/dallan/Documents/Repos/databroker/databroker/databroker.py</span> in <span class="ni">find_headers</span><span class="nt">(self, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">180</span><span class="sd">         warnings.warn(&quot;Use DataBroker() instead of &quot;</span>
<span class="g-Whitespace">    </span><span class="mi">181</span><span class="sd">                       &quot;DataBroker.find_headers()&quot;, UserWarning)</span>
<span class="ne">--&gt; </span><span class="mi">182</span><span class="sd">         return self(**kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">183</span><span class="sd"> </span>
<span class="g-Whitespace">    </span><span class="mi">184</span><span class="sd">     def fetch_events(self, headers, fill=True):</span>

<span class="nn">/Users/dallan/Documents/Repos/databroker/databroker/databroker.py</span> in <span class="ni">__call__</span><span class="nt">(self, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">150</span><span class="sd">         &quot;&quot;&quot;</span>
<span class="g-Whitespace">    </span><span class="mi">151</span>         <span class="n">data_key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;data_key&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">152</span>         <span class="n">run_start</span> <span class="o">=</span> <span class="n">find_run_starts</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">153</span>         <span class="k">if</span> <span class="n">data_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="g-Whitespace">    </span><span class="mi">154</span>             <span class="n">node_name</span> <span class="o">=</span> <span class="s">&#39;data_keys.{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_key</span><span class="p">)</span>

<span class="nn">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py</span> in <span class="ni">inner</span><span class="nt">(*args, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">117</span>         <span class="n">host</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">connection_config</span><span class="p">[</span><span class="s">&#39;host&#39;</span><span class="p">]</span>
<span class="g-Whitespace">    </span><span class="mi">118</span>         <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">connection_config</span><span class="p">[</span><span class="s">&#39;port&#39;</span><span class="p">])</span>
<span class="ne">--&gt; </span><span class="mi">119</span>         <span class="n">db_connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">120</span>         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g-Whitespace">    </span><span class="mi">121</span>     <span class="k">return</span> <span class="n">inner</span>

<span class="nn">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py</span> in <span class="ni">db_connect</span><span class="nt">(database, host, port)</span>
<span class="g-Whitespace">     </span><span class="mi">96</span>        <span class="n">re</span><span class="o">-</span><span class="n">connect</span><span class="o">.</span>
<span class="g-Whitespace">     </span><span class="mi">97</span>     <span class="s">&quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">98</span><span class="s">     return connect(db=database, host=host, port=port, alias=ALIAS)</span>
<span class="g-Whitespace">     </span><span class="mi">99</span><span class="s"> </span>
<span class="g-Whitespace">    </span><span class="mi">100</span><span class="s"> </span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">connect</span><span class="nt">(db, alias, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">159</span><span class="s">         register_connection(alias, db, **kwargs)</span>
<span class="g-Whitespace">    </span><span class="mi">160</span><span class="s"> </span>
<span class="ne">--&gt; </span><span class="mi">161</span><span class="s">     return get_connection(alias)</span>
<span class="g-Whitespace">    </span><span class="mi">162</span><span class="s"> </span>
<span class="g-Whitespace">    </span><span class="mi">163</span><span class="s"> </span>

<span class="nn">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py</span> in <span class="ni">get_connection</span><span class="nt">(alias, reconnect)</span>
<span class="g-Whitespace">    </span><span class="mi">122</span><span class="s">             _connections[alias] = connection_class(**conn_settings)</span>
<span class="g-Whitespace">    </span><span class="mi">123</span><span class="s">         except Exception as e:</span>
<span class="ne">--&gt; </span><span class="mi">124</span><span class="s">             raise ConnectionError(&quot;Cannot connect to database </span><span class="si">%s</span><span class="s"> :</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot; % (alias, e))</span>
<span class="g-Whitespace">    </span><span class="mi">125</span><span class="s">     return _connections[alias]</span>
<span class="g-Whitespace">    </span><span class="mi">126</span><span class="s"> </span>

<span class="ne">ConnectionError</span>: Cannot connect to database mds :
<span class="s">[Errno 61] Connection refused</span>

<span class="gp">In [43]: </span><span class="n">headers_measuring_temperature</span> <span class="o">=</span> <span class="n">DataBroker</span><span class="o">.</span><span class="n">find_headers</span><span class="p">(</span><span class="n">data_key</span><span class="o">=</span><span class="s">&#39;Tsam&#39;</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ---------------------------------------------------------------------------</span>
<span class="go">AutoReconnect                             Traceback (most recent call last)</span>
<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __init__(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="go">    365             try:</span>
<span class="go">--&gt; 366                 self._ensure_connected(True)</span>
<span class="go">    367             except AutoReconnect as e:</span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in _ensure_connected(self, sync)</span>
<span class="go">    929         &quot;&quot;&quot;</span>
<span class="go">--&gt; 930         self.__ensure_member()</span>
<span class="go">    931 </span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __ensure_member(self)</span>
<span class="go">    802                 try:</span>
<span class="go">--&gt; 803                     member, nodes = self.__find_node()</span>
<span class="go">    804                     return member</span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __find_node(self)</span>
<span class="go">    893             # Couldn&#39;t find a suitable host.</span>
<span class="go">--&gt; 894             raise AutoReconnect(&#39;, &#39;.join(errors))</span>
<span class="go">    895 </span>

<span class="go">AutoReconnect: [Errno 61] Connection refused</span>

<span class="go">During handling of the above exception, another exception occurred:</span>

<span class="go">ConnectionFailure                         Traceback (most recent call last)</span>
<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py in get_connection(alias, reconnect)</span>
<span class="go">    121         try:</span>
<span class="go">--&gt; 122             _connections[alias] = connection_class(**conn_settings)</span>
<span class="go">    123         except Exception as e:</span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/pymongo/mongo_client.py in __init__(self, host, port, max_pool_size, document_class, tz_aware, _connect, **kwargs)</span>
<span class="go">    368                 # ConnectionFailure makes more sense here than AutoReconnect</span>
<span class="go">--&gt; 369                 raise ConnectionFailure(str(e))</span>
<span class="go">    370 </span>

<span class="go">ConnectionFailure: [Errno 61] Connection refused</span>

<span class="go">During handling of the above exception, another exception occurred:</span>

<span class="go">ConnectionError                           Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-43-09a7362a9781&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 headers_measuring_temperature = DataBroker.find_headers(data_key=&#39;Tsam&#39;)</span>

<span class="go">/Users/dallan/Documents/Repos/databroker/databroker/databroker.py in find_headers(self, **kwargs)</span>
<span class="go">    180         warnings.warn(&quot;Use DataBroker() instead of &quot;</span>
<span class="go">    181                       &quot;DataBroker.find_headers()&quot;, UserWarning)</span>
<span class="go">--&gt; 182         return self(**kwargs)</span>
<span class="go">    183 </span>
<span class="go">    184     def fetch_events(self, headers, fill=True):</span>

<span class="go">/Users/dallan/Documents/Repos/databroker/databroker/databroker.py in __call__(self, **kwargs)</span>
<span class="go">    150         &quot;&quot;&quot;</span>
<span class="go">    151         data_key = kwargs.pop(&#39;data_key&#39;, None)</span>
<span class="go">--&gt; 152         run_start = find_run_starts(**kwargs)</span>
<span class="go">    153         if data_key is not None:</span>
<span class="go">    154             node_name = &#39;data_keys.{0}&#39;.format(data_key)</span>

<span class="go">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py in inner(*args, **kwargs)</span>
<span class="go">    117         host = conf.connection_config[&#39;host&#39;]</span>
<span class="go">    118         port = int(conf.connection_config[&#39;port&#39;])</span>
<span class="go">--&gt; 119         db_connect(database=database, host=host, port=port)</span>
<span class="go">    120         return func(*args, **kwargs)</span>
<span class="go">    121     return inner</span>

<span class="go">/Users/dallan/Documents/Repos/metadatastore/metadatastore/commands.py in db_connect(database, host, port)</span>
<span class="go">     96        re-connect.</span>
<span class="go">     97     &quot;&quot;&quot;</span>
<span class="go">---&gt; 98     return connect(db=database, host=host, port=port, alias=ALIAS)</span>
<span class="go">     99 </span>
<span class="go">    100 </span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py in connect(db, alias, **kwargs)</span>
<span class="go">    159         register_connection(alias, db, **kwargs)</span>
<span class="go">    160 </span>
<span class="go">--&gt; 161     return get_connection(alias)</span>
<span class="go">    162 </span>
<span class="go">    163 </span>

<span class="go">/Users/dallan/miniconda/envs/py3/lib/python3.4/site-packages/mongoengine-0.8.7-py3.4.egg/mongoengine/connection.py in get_connection(alias, reconnect)</span>
<span class="go">    122             _connections[alias] = connection_class(**conn_settings)</span>
<span class="go">    123         except Exception as e:</span>
<span class="go">--&gt; 124             raise ConnectionError(&quot;Cannot connect to database %s :\n%s&quot; % (alias, e))</span>
<span class="go">    125     return _connections[alias]</span>
<span class="go">    126 </span>

<span class="go">ConnectionError: Cannot connect to database mds :</span>
<span class="go">[Errno 61] Connection refused</span>
</pre></div>
</div>
<p>Any of these results, whether a single Header or a list of Headers, can be
passed to <tt class="docutils literal"><span class="pre">DataBroker.fetch_events()</span></tt> as shown in the previous sections above.</p>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015 Brookhaven National Lab.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>